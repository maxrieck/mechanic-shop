
swagger: '2.0'
info:
  title: "Mechanic Shop"
  description: "API for tracking customers, service tickets, mechanics and inventory"
  version: "1.0.0"
host: "mechanic-shop-1-xjus.onrender.com"
schemes: 
  - "https"
consumes: 
  - "application/json"
produces: 
  - "application/json"

securityDefinitions:
  bearerAuth:
    type: apiKey
    name: Authorization
    in: header

paths: 
  /inventory:
    post:
      tags:
        - inventory
      summary: "Create a new inventory item."
      description: "Endpoint to create/register a new inventory item."
      parameters:
        - in: "body"
          name: "body"
          description: "Information required to create a new inventory item."
          required: true
          schema:
            $ref: "#/definitions/CreateInventoryPayload"
      responses:
        201:
          description: "Successfully created inventory item."
          schema:
            $ref: "#/definitions/CreateInventoryResponse"
          examples:
            application/json:
              id: 1
              name: "Brake Pads"
              price: 49.99

    get:
      tags:
        - inventory
      summary: "Get all inventory items."
      description: "Returns a list of all inventory items."
      responses:
        200:
          description: "Successfully retrieved inventory items."
          schema:
            $ref: "#/definitions/AllInventory"

  /inventory/{inventory_id}:
    get:
      tags:
        - inventory
      summary: "Get an inventory item by ID."
      description: "Returns a single inventory item by its ID."
      parameters:
        - name: inventory_id
          in: path
          required: true
          type: integer
      responses:
        200:
          description: "Successfully retrieved inventory item."
          schema:
            $ref: "#/definitions/CreateInventoryResponse"
        404:
          description: "Inventory item not found."
          schema:
            $ref: "#/definitions/ErrorResponse"

    put:
      tags:
        - inventory
      summary: "Update an inventory item by ID."
      description: "Updates an inventory item's information."
      parameters:
        - name: inventory_id
          in: path
          required: true
          type: integer
        - in: "body"
          name: "body"
          description: "Information to update the inventory item."
          required: true
          schema:
            $ref: "#/definitions/UpdateInventoryPayload"
      responses:
        200:
          description: "Successfully updated inventory item."
          schema:
            $ref: "#/definitions/CreateInventoryResponse"
        404:
          description: "Inventory item not found."
          schema:
            $ref: "#/definitions/ErrorResponse"

    delete:
      tags:
        - inventory
      summary: "Delete an inventory item by ID."
      description: "Deletes an inventory item from the system."
      parameters:
        - name: inventory_id
          in: path
          required: true
          type: integer
      responses:
        200:
          description: "Successfully deleted inventory item."
          schema:
            $ref: "#/definitions/DeleteInventoryResponse"
        404:
          description: "Inventory item not found."
          schema:
            $ref: "#/definitions/ErrorResponse"

  /service_tickets:
    post:
      tags:
        - service_tickets
      summary: "Create a new service ticket."
      description: "Endpoint to create/register a new service ticket."
      parameters:
        - in: "body"
          name: "body"
          description: "Information required to create a new service ticket."
          required: true
          schema:
            $ref: "#/definitions/CreateServiceTicketPayload"
      responses:
        201:
          description: "Successfully created service ticket."
          schema:
            $ref: "#/definitions/CreateServiceTicketResponse"
          examples:
            application/json:
              id: 1
              VIN: "1HGCM82633A004352"
              service_date: "2023-11-27"
              service_desc: "Brake replacement"
              customer_id: 2

    get:
      tags:
        - service_tickets
      summary: "Get all service tickets."
      description: "Returns a list of all service tickets."
      responses:
        200:
          description: "Successfully retrieved service tickets."
          schema:
            $ref: "#/definitions/AllServiceTickets"

  /service_tickets/{id}:
    get:
      tags:
        - service_tickets
      summary: "Get a service ticket by ID."
      description: "Returns a single service ticket by its ID."
      parameters:
        - name: id
          in: path
          required: true
          type: integer
      responses:
        200:
          description: "Successfully retrieved service ticket."
          schema:
            $ref: "#/definitions/CreateServiceTicketResponse"
        404:
          description: "Service ticket not found."
          schema:
            $ref: "#/definitions/ErrorResponse"

  /service_tickets/{ticket_id}:
    put:
      tags:
        - service_tickets
      summary: "Edit a service ticket by ID."
      description: "Updates a service ticket's information."
      parameters:
        - name: ticket_id
          in: path
          required: true
          type: integer
        - in: "body"
          name: "body"
          description: "Information to update the service ticket."
          required: true
          schema:
            $ref: "#/definitions/UpdateServiceTicketPayload"
      responses:
        200:
          description: "Successfully updated service ticket."
          schema:
            $ref: "#/definitions/CreateServiceTicketResponse"
        404:
          description: "Service ticket not found."
          schema:
            $ref: "#/definitions/ErrorResponse"

  /service_tickets/{ticket_id}/add_item/{inventory_id}:
    put:
      tags:
        - service_tickets
      summary: "Add inventory item to service ticket."
      description: "Adds an inventory item to a service ticket."
      parameters:
        - name: ticket_id
          in: path
          required: true
          type: integer
        - name: inventory_id
          in: path
          required: true
          type: integer
      responses:
        200:
          description: "Successfully added inventory item to service ticket."
          schema:
            $ref: "#/definitions/CreateServiceTicketResponse"
        400:
          description: "Item already used or invalid IDs."
          schema:
            $ref: "#/definitions/ErrorResponse"

  /service_tickets/{ticket_id}/assign_mechanic/{mechanic_id}:
    put:
      tags:
        - service_tickets
      summary: "Assign mechanic to service ticket."
      description: "Assigns a mechanic to a service ticket."
      parameters:
        - name: ticket_id
          in: path
          required: true
          type: integer
        - name: mechanic_id
          in: path
          required: true
          type: integer
      responses:
        200:
          description: "Successfully assigned mechanic to service ticket."
          schema:
            $ref: "#/definitions/CreateServiceTicketResponse"
        400:
          description: "Mechanic already assigned or invalid IDs."
          schema:
            $ref: "#/definitions/ErrorResponse"

  /service_tickets/{ticket_id}/remove_mechanic/{mechanic_id}:
    put:
      tags:
        - service_tickets
      summary: "Remove mechanic from service ticket."
      description: "Removes a mechanic from a service ticket."
      parameters:
        - name: ticket_id
          in: path
          required: true
          type: integer
        - name: mechanic_id
          in: path
          required: true
          type: integer
      responses:
        200:
          description: "Successfully removed mechanic from service ticket."
          schema:
            $ref: "#/definitions/CreateServiceTicketResponse"
        400:
          description: "Mechanic not assigned or invalid IDs."
          schema:
            $ref: "#/definitions/ErrorResponse"
  /mechanics:
    post:
      tags:
        - mechanics
      summary: "Create a new mechanic."
      description: "Endpoint to create/register a new mechanic. Emails must be unique."
      parameters:
        - in: "body"
          name: "body"
          description: "Information required to create a new mechanic."
          required: true
          schema:
            $ref: "#/definitions/CreateMechanicPayload"
      responses:
        201:
          description: "Successfully created mechanic."
          schema:
            $ref: "#/definitions/CreateMechanicResponse"
          examples:
            application/json:
              id: 1
              name: Jane Smith
              email: jane@email.com
              phone: "555-5678"
              salary: 50000.00

    get:
      tags:
        - mechanics
      summary: "Get all mechanics."
      description: "Returns a list of all mechanics."
      responses:
        200:
          description: "Successfully retrieved mechanics."
          schema:
            $ref: "#/definitions/AllMechanics"

  /mechanics/{mechanic_id}:
    get:
      tags:
        - mechanics
      summary: "Get a mechanic by ID."
      description: "Returns a single mechanic by their ID."
      parameters:
        - name: mechanic_id
          in: path
          required: true
          type: integer
      responses:
        200:
          description: "Successfully retrieved mechanic."
          schema:
            $ref: "#/definitions/CreateMechanicResponse"
        404:
          description: "Mechanic not found."
          schema:
            $ref: "#/definitions/ErrorResponse"

    put:
      tags:
        - mechanics
      summary: "Update a mechanic by ID."
      description: "Updates a mechanic's information."
      parameters:
        - name: mechanic_id
          in: path
          required: true
          type: integer
        - in: "body"
          name: "body"
          description: "Information to update the mechanic."
          required: true
          schema:
            $ref: "#/definitions/UpdateMechanicPayload"
      responses:
        200:
          description: "Successfully updated mechanic."
          schema:
            $ref: "#/definitions/CreateMechanicResponse"
        404:
          description: "Mechanic not found."
          schema:
            $ref: "#/definitions/ErrorResponse"

    delete:
      tags:
        - mechanics
      summary: "Delete a mechanic by ID."
      description: "Deletes a mechanic from the system."
      parameters:
        - name: mechanic_id
          in: path
          required: true
          type: integer
      responses:
        200:
          description: "Successfully deleted mechanic."
          schema:
            $ref: "#/definitions/DeleteMechanicResponse"
        404:
          description: "Mechanic not found."
          schema:
            $ref: "#/definitions/ErrorResponse"

  /mechanics/popular:
    get:
      tags:
        - mechanics
      summary: "Get popular mechanics."
      description: "Returns mechanics sorted by number of service tickets assigned."
      responses:
        200:
          description: "Successfully retrieved popular mechanics."
          schema:
            $ref: "#/definitions/AllMechanics"
  /customers/login:
    post:
      tags:
        - customers
      summary: "Login endpoint, (generates token)"
      description: "Validates customer credentials, generates and returns a customer specific token"
      parameters:
        - in: "body"
          name: "body"
          definition: "Login Credentials"
          required: true
          schema: 
            $ref: "#/definitions/LoginCredentials"
      responses:
        200:
          definitions: "Login successful"
          schema:
            $ref: "#/definitions/LoginResponse"
  
  
  /customers:
    post:
      tags:
        - customers
      summary: "Endpoint to create/register a new customer."
      description: "Endpoint to create a new customer in the mechanic shop system. Emails must be unique."
      parameters:
        - in: "body"
          name: "body"
          description: "Information required to create a new customer."
          required: true
          schema:
            $ref: "#/definitions/CreateCustomerPayload"
      responses:
        201:
          description: "Successful Customer Creation"
          schema:
            $ref: "#/definitions/CreateCustomerResponse"
          examples:
            application/json:
              id: 1
              name: John Doe
              email: johnd@email.com
              phone: "555-1234"

    get: 
      tags:
        - Customers
      summary: "Returns all Customers"
      description: "Endpoint to retrieve a list of all members"
      responses:
        200:
          description: "Retrieved Customers Successfully"
          schema:
            $ref: "#/definitions/AllCustomers"

    put:
      tags:
        - Customers
      summary: "Endpoint to update a customer"
      description: "Endpoint to update a customer, this is a token authenticated route, and the customer must be logged in to update their account"
      security: 
        - bearerAuth: []
      parameters: 
        - in: "body"
          name: "body"
          description: "Information required to update a Customer"
          required: true
          schema: 
            $ref: "#/definitions/UpdateCustomerPayload"
      responses: 
        200:
          description: "Successfully Updated Customer"
          schema:
            $ref: "#/definitions/UpdateCustomerResponse"
          examples:
            application/json:
              id: 1
              name: John Doe
              email: johnd@email.com
              phone: "555-1234"

    delete:
      tags:
        - Customers
      summary: "Enpoint to delete a customer"
      description: "Endpoint to delete a customer. Requires token authentication, customer must be logged in to delete their account"
      security:
       - bearerAuth: []
      responses:
        200:
          description: "Successfully Deleted customer"           
          schema:
            $ref: "#/definitions/DeleteCustomerResponse"
          examples:
            application/json:
              message: "successfully deleted user <customer_id>."


definitions: 
  CreateInventoryPayload:
    type: "object"
    properties:
      name:
        type: "string"
      price:
        type: "number"
    required:
      - name
      - price

  CreateInventoryResponse:
    type: "object"
    properties:
      id:
        type: "integer"
      name:
        type: "string"
      price:
        type: "number"

  AllInventory:
    type: "array"
    items:
      $ref: "#/definitions/CreateInventoryResponse"

  UpdateInventoryPayload:
    type: "object"
    properties:
      name:
        type: "string"
      price:
        type: "number"
    required:
      - name
      - price

  DeleteInventoryResponse:
    type: "object"
    properties:
      message:
        type: "string"

  CreateServiceTicketPayload:
    type: "object"
    properties:
      VIN:
        type: "string"
      service_date:
        type: "string"
        format: "date"
      service_desc:
        type: "string"
      customer_id:
        type: "integer"
    required:
      - VIN
      - service_date
      - service_desc
      - customer_id

  CreateServiceTicketResponse:
    type: "object"
    properties:
      id:
        type: "integer"
      VIN:
        type: "string"
      service_date:
        type: "string"
        format: "date"
      service_desc:
        type: "string"
      customer_id:
        type: "integer"

  AllServiceTickets:
    type: "array"
    items:
      $ref: "#/definitions/CreateServiceTicketResponse"

  UpdateServiceTicketPayload:
    type: "object"
    properties:
      VIN:
        type: "string"
      service_date:
        type: "string"
        format: "date"
      service_desc:
        type: "string"
      customer_id:
        type: "integer"
    required:
      - VIN
      - service_date
      - service_desc
      - customer_id
  CreateMechanicPayload:
    type: "object"
    properties:
      name:
        type: "string"
      email:
        type: "string"
      phone:
        type: "string"
      salary:
        type: "number"
    required:
      - name
      - email
      - phone
      - salary

  CreateMechanicResponse:
    type: "object"
    properties:
      id:
        type: "integer"
      name:
        type: "string"
      email:
        type: "string"
      phone:
        type: "string"
      salary:
        type: "number"

  AllMechanics:
    type: "array"
    items:
      $ref: "#/definitions/CreateMechanicResponse"

  UpdateMechanicPayload:
    type: "object"
    properties:
      name:
        type: "string"
      email:
        type: "string"
      phone:
        type: "string"
      salary:
        type: "number"
    required:
      - name
      - email
      - phone
      - salary

  DeleteMechanicResponse:
    type: "object"
    properties:
      message:
        type: "string"

  ErrorResponse:
    type: "object"
    properties:
      error:
        type: "string"

  LoginCredentials:
    type: "object"
    properties:
      email:
        type: "string"
      password:
        type: "string"

    required: 
      - email
      - password
  
  LoginResponse:
    type: "object"
    properties:
      token:
        type: "string"
      message:
        type: "string"
        example: "Login successful"
      status:
        type: "string"
        example: "Success"

  CreateCustomerPayload:
    type: "object"
    properties:
      name:
        type: "string"
      email: 
        type: "string"
      password: 
        type: "string"
      phone:
        type: "string"
    
    required:
      - name  
      - email
      - password
      - phone
    
  CreateCustomerResponse:
    type: "object"
    properties:
      id:
        type: "integer"
      name:
        type: "string"
      email:
        type: "string"
      phone:
        type: "string"
        
  AllCustomers:
    types: "array"
    items:
      type: "object"
      properties:
        id:
          type: "integer"
        name:
          type: "string"
        email:
          type: "string"
        pphone:
          type: "string"
  
  UpdateCustomerPayload:
    type: "object"
    properties:
      name:
        type: "string"
      email: 
        type: "string"
      password: 
        type: "string"
      phone:
        type: "string"
    
    required:
      - name  
      - email
      - password
      - phone
    
  UpdateCustomerResponse:
    type: "object"
    properties:
      id:
        type: "integer"
      name:
        type: "string"
      email:
        type: "string"
      phone:
        type: "string"

  DeleteCustomerResponse:
    type: "object"
    properties:
      message:
        type: "string" 